
# Registry testen
docker login devspace.ff-solutions.de:5001

# Gitlab Runner starten
mkdir /vagrant/docker-runner-data
touch /vagrant/docker-runner-data/config.toml

docker run -d \
    --name docker-runner \
    --network gitlab-net \
    --restart always \
    --dns 172.18.0.7 \
    -v /vagrant/docker-runner-data/config.toml:/etc/gitlab-runner/config.toml \
    -v /var/run/docker.sock:/var/run/docker.sock \
    gitlab/gitlab-runner:v10.0.2

# Gitlab Runner registrieren
docker exec -it docker-runner gitlab-runner register --non-interactive --name docker --url https://devspace.ff-solutions.de --registration-token TOKEN_GOES_HERE --executor docker --tag-list docker --docker-image alpine:latest --docker-dns 172.18.0.7 --docker-network-mode gitlab-net --docker-volumes /var/run/docker.sock:/var/run/docker.sock


# Firewall Server Box konfigurieren
sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080

# Rancher starten
docker run -d -v ~/rancher-data:/var/lib/mysql --restart=unless-stopped --network gitlab-net -p 8080:8080 rancher/server:v1.6.10

